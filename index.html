<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Weihnachtsgeschenk</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root{--red-primary:#dc2626;--gold:#fbbf24;--green:#059669}
        /* Basis-Animationen / Styles (gekürzt, wie vorher) */
        @keyframes shake {0%,100%{transform:rotate(0deg)}25%{transform:rotate(-5deg)}75%{transform:rotate(5deg)}}
        @keyframes openGift {0%{transform:rotateX(0deg)}100%{transform:rotateX(-120deg)}}
        @keyframes openBowLeft {0%{transform:translate(0,0) rotate(-12deg)}100%{transform:translate(-60px,-20px) rotate(-45deg);opacity:0}}
        @keyframes openBowRight {0%{transform:translate(0,0) rotate(12deg)}100%{transform:translate(60px,-20px) rotate(45deg);opacity:0}}
        @keyframes openBowCenter {0%{transform:translate(-50%,-50%) rotate(45deg) scale(1)}100%{transform:translate(-50%,-50%) rotate(45deg) scale(0);opacity:0}}
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }
        @keyframes sparkle {0%,100%{transform:scale(0) rotate(0);opacity:0}50%{transform:scale(1) rotate(180deg);opacity:1}}
        body{ background: radial-gradient(ellipse at top,#1e3a8a,#1e1b4b); position:relative; overflow:hidden; font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;}
        body::before{ content:''; position:absolute; inset:0; background: radial-gradient(2px 2px at 20% 30%, white, transparent), radial-gradient(2px 2px at 60% 70%, white, transparent), radial-gradient(1px 1px at 50% 50%, white, transparent); background-size:200px 200px; animation: sparkle 3s ease-in-out infinite; pointer-events:none; }
        .gift-pattern{ background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.08) 10px, rgba(255,255,255,0.08) 20px); }
        .ribbon-shine{ background:linear-gradient(135deg,#fde68a 0%,#fbbf24 50%,#f59e0b 100%); }
        .bow-shine{ background:linear-gradient(135deg,#fde68a 0%,#fbbf24 50%,#f59e0b 100%); }
        .snowflake{ position:absolute; background:white; border-radius:50%; pointer-events:none; animation: fall linear infinite; }
        .sparkle{ position:absolute; width:4px; height:4px; background:white; clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%); animation: sparkle 3s ease-in-out infinite; }
        .glass{ background: rgba(255,255,255,0.08); backdrop-filter: blur(8px); border:1px solid rgba(255,255,255,0.12); }

        /* ==== Konfetti (absolute px-Positionen) ==== */
        .confetti{ position:fixed; width:8px; height:12px; opacity:0.95; border-radius:2px; pointer-events:none; transform-origin:center; }
        @keyframes confettiFall {
            to { transform: translateY(110vh) rotate(720deg) translateX(40px); opacity:0; }
        }

        /* ==== Musik-Button zentral unten (responsive) ==== */
        .music-control{
            position:fixed; left:50%; transform:translateX(-50%); bottom:18px; z-index:120;
            display:flex; align-items:center; gap:10px;
            background: rgba(0,0,0,0.45); padding:10px 14px; border-radius:999px;
            backdrop-filter: blur(6px); border:1px solid rgba(255,255,255,0.08); box-shadow:0 8px 30px rgba(0,0,0,0.45);
        }
        .music-btn{ width:48px; height:48px; display:grid; place-items:center; border-radius:999px; background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01)); cursor:pointer; border:1px solid rgba(255,255,255,0.06);}
        .music-title{ color:#fff; font-weight:600; font-size:13px; white-space:nowrap; max-width:200px; overflow:hidden; text-overflow:ellipsis;}
        .music-state{ color:#e6e6e6; font-size:12px; opacity:0.9; }
        @media (max-width:420px){ .music-title{ display:none; } .music-control{ padding:8px; bottom:12px; } }

        /* Geschenk-öffnen-Klasse */
        .open-lid{ animation: openGift 0.6s ease-out forwards; transform-origin: bottom; }
        .open-bow-left{ animation: openBowLeft 0.5s ease-out forwards; }
        .open-bow-right{ animation: openBowRight 0.5s ease-out forwards; }
        .open-bow-center{ animation: openBowCenter 0.5s ease-out forwards; }

    </style>
</head>
<body class="min-h-screen flex items-center justify-center">

    <!-- Lichterkette + Deko -->
    <div class="fixed top-4 left-0 right-0 flex justify-center gap-6 z-0 pointer-events:none">
        <div class="light text-red-500" style="animation-delay:0s;"></div>
        <div class="light text-yellow-400" style="animation-delay:0.3s;"></div>
        <div class="light text-green-500" style="animation-delay:0.6s;"></div>
    </div>

    <div class="fixed left-4 bottom-8 opacity-20"><div class="tree relative"><div class="tree-trunk"></div></div></div>
    <div class="fixed right-4 bottom-8 opacity-20"><div class="tree relative"><div class="tree-trunk"></div></div></div>

    <!-- Hauptbereich mit Geschenk -->
    <div class="text-center relative z-10 px-4">
        <div id="gift-container" class="relative cursor-pointer perspective-1000" onclick="openGift()">
            <!-- Deckel -->
            <div id="gift-lid" class="relative z-10 mb-1 sm:mb-2">
                <div class="w-40 h-14 sm:w-56 sm:h-20 bg-gradient-to-br from-red-500 via-red-600 to-red-700 rounded-t-lg mx-auto shadow-2xl gift-pattern border-2 sm:border-4 border-red-800 relative overflow-visible">
                    <div class="absolute top-1 left-2 w-14 h-6 sm:top-2 sm:left-4 sm:w-20 sm:h-8 bg-white opacity-20 rounded-full blur-sm"></div>
                    <div class="absolute top-1/2 left-0 right-0 h-4 sm:h-6 ribbon-shine transform -translate-y-1/2 shadow-lg border-t border-b sm:border-t-2 sm:border-b-2 border-yellow-600 z-10"></div>
                    <div class="absolute top-1/2 left-0 right-0 h-0.5 sm:h-1 bg-yellow-300 transform -translate-y-1/2 z-10"></div>
                    <div class="absolute top-0 bottom-0 left-1/2 w-4 sm:w-6 ribbon-shine transform -translate-x-1/2 shadow-lg border-l border-r sm:border-l-2 sm:border-r-2 border-yellow-600 z-10"></div>
                    <div class="absolute top-0 bottom-0 left-1/2 w-0.5 sm:w-1 bg-yellow-300 transform -translate-x-1/2 z-10"></div>

                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-20">
                        <div id="bow-center" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 rotate-45 z-30 w-5 h-5 sm:w-8 sm:h-8 bow-shine rounded shadow-xl border border-yellow-600 sm:border-2"></div>
                        <div id="bow-left" class="absolute top-1/2 left-1/2 transform -translate-y-1/2 -translate-x-full -rotate-12">
                            <div class="w-8 h-8 sm:w-12 sm:h-12 bow-shine rounded-full shadow-xl border border-yellow-600 sm:border-2 -ml-1 sm:-ml-2"></div>
                        </div>
                        <div id="bow-right" class="absolute top-1/2 left-1/2 transform -translate-y-1/2 rotate-12">
                            <div class="w-8 h-8 sm:w-12 sm:h-12 bow-shine rounded-full shadow-xl border border-yellow-600 sm:border-2 -mr-1 sm:-mr-2"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Box -->
            <div id="gift-box" class="w-40 h-40 sm:w-56 sm:h-56 bg-gradient-to-br from-red-500 via-red-600 to-red-800 mx-auto shadow-2xl rounded-b-lg relative gift-pattern border-2 sm:border-4 border-red-800">
                <div class="absolute top-2 left-3 w-16 h-20 sm:top-4 sm:left-6 sm:w-24 sm:h-32 bg-white opacity-20 rounded-full blur-md"></div>
                <div class="absolute top-0 bottom-0 left-1/2 w-5 sm:w-8 ribbon-shine transform -translate-x-1/2 shadow-lg border-l border-r sm:border-l-2 sm:border-r-2 border-yellow-600"></div>
                <div class="absolute top-0 bottom-0 left-1/2 w-0.5 sm:w-1 bg-yellow-300 transform -translate-x-1/2"></div>
                <div class="star absolute" style="top:20px; left:20px;"></div>
                <div class="star absolute" style="bottom:35px; right:20px; transform:scale(0.8);"></div>
                <div class="star absolute" style="top:50%; right:10px; transform:scale(0.6);"></div>
                <div class="absolute -bottom-2 sm:-bottom-4 left-1/2 transform -translate-x-1/2 w-44 h-6 sm:w-64 sm:h-8 bg-black opacity-30 blur-xl rounded-full"></div>
            </div>
        </div>

        <!-- Nachricht-Modal -->
        <div id="message" class="hidden fixed inset-0 flex items-center justify-center z-50 px-4">
            <div class="glass rounded-2xl p-4 sm:p-8 shadow-2xl transform scale-0 transition-transform duration-500 border-2 border-white/30 max-w-sm" id="message-box">
                <div id="typed-text" class="text-white font-bold text-lg sm:text-2xl drop-shadow-lg text-center"></div>
            </div>
        </div>

        <div class="fixed inset-0 pointer-events-none" id="snow-container"></div>
    </div>

    <!-- Audio (ersetze src) -->
    <audio id="bg-music" loop preload="auto">
        <source src="dein_lied.mp3" type="audio/mpeg">
        Dein Browser unterstützt kein Audio-Tag.
    </audio>

    <!-- Musik-Kontrolle (zentral unten) -->
    <div class="music-control" id="music-control" role="region" aria-label="Musik Steuerung">
        <button class="music-btn" id="music-toggle" title="Musik abspielen / pausieren" aria-label="Musik abspielen">
            <svg id="icon-play" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
            <svg id="icon-pause" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
        </button>
        <div style="display:flex;flex-direction:column;gap:4px;">
            <div class="music-title" id="music-title">Weihnachtsmusik</div>
            <div class="music-state" id="music-state">Pause</div>
        </div>
    </div>

    <div id="music-note" style="position:fixed;left:50%;transform:translateX(-50%);bottom:84px;background:rgba(0,0,0,0.6);color:#fff;padding:8px 12px;border-radius:10px;font-size:13px;display:none;z-index:130;">Zum Starten antippen</div>

<script>
    // === Elemente & Konstanten ===
    const audio = document.getElementById('bg-music');
    const toggleBtn = document.getElementById('music-toggle');
    const iconPlay = document.getElementById('icon-play');
    const iconPause = document.getElementById('icon-pause');
    const musicState = document.getElementById('music-state');
    const musicNote = document.getElementById('music-note');
    const LS_PLAY_KEY = 'xmasMusicPlaying';
    audio.volume = 0.6;

    // === UI Helpers ===
    function updateToggleUI(isPlaying){
        if(isPlaying){ iconPlay.style.display='none'; iconPause.style.display='block'; musicState.textContent='Wiedergabe'; toggleBtn.setAttribute('aria-label','Musik pausieren'); }
        else { iconPlay.style.display='block'; iconPause.style.display='none'; musicState.textContent='Pause'; toggleBtn.setAttribute('aria-label','Musik abspielen'); }
    }
    function showStartHint(){ musicNote.style.display='block'; musicNote.style.opacity='1'; setTimeout(()=>{ musicNote.style.opacity='0'; }, 2200); setTimeout(()=>{ musicNote.style.display='none'; }, 2500); }

    // === Fade helpers ===
    function fadeAudioTo(targetVolume=0.6,duration=700){
        const start=audio.volume; const diff=targetVolume-start; const stepTime=40; const steps=Math.max(1,Math.floor(duration/stepTime)); let cur=0;
        const t=setInterval(()=>{ cur++; audio.volume = Math.min(1, Math.max(0, start + diff*(cur/steps))); if(cur>=steps) clearInterval(t); }, stepTime);
    }
    function fadeOutAndPause(duration=400){
        const start=audio.volume; const stepTime=40; const steps=Math.max(1,Math.floor(duration/stepTime)); let cur=0;
        const t=setInterval(()=>{ cur++; audio.volume = Math.max(0, start * (1 - cur/steps)); if(cur>=steps){ clearInterval(t); audio.pause(); } }, stepTime);
    }

    // === Play/Pause ===
    async function toggleMusic(userInitiated=true){
        if(audio.paused){
            try{
                await audio.play();
                if(userInitiated) fadeAudioTo(0.6,700);
                localStorage.setItem(LS_PLAY_KEY,'true');
                updateToggleUI(true);
            }catch(err){
                showStartHint();
                updateToggleUI(false);
                console.warn('Play blockiert:',err);
            }
        } else {
            fadeOutAndPause(400);
            localStorage.setItem(LS_PLAY_KEY,'false');
            updateToggleUI(false);
        }
    }
    toggleBtn.addEventListener('click', ()=> toggleMusic(true));

    function initMusic(){
        const shouldPlay = localStorage.getItem(LS_PLAY_KEY) === 'true';
        updateToggleUI(shouldPlay);
        if(shouldPlay){
            audio.play().then(()=> updateToggleUI(true)).catch(()=> { updateToggleUI(false); showStartHint(); });
        }
    }

    // === Confetti: jetzt aus Geschenk-Position ===
    function confettiBurstFrom(x, y, count = 36){
        const colors = ['#f59e0b','#fbbf24','#dc2626','#10b981','#fff1c2'];
        for(let i=0;i<count;i++){
            const el = document.createElement('div');
            el.className = 'confetti';
            el.style.left = x + (Math.random()*40 - 20) + 'px'; // small spread around origin
            el.style.top = y + (Math.random()*20 - 10) + 'px';
            el.style.background = colors[Math.floor(Math.random()*colors.length)];
            el.style.width = (6 + Math.random()*8) + 'px';
            el.style.height = (10 + Math.random()*14) + 'px';
            el.style.opacity = 0.95;
            el.style.transform = `rotate(${Math.random()*360}deg)`;
            // random drift via animation-duration and translateX in keyframe
            el.style.animationName = 'confettiFall';
            el.style.animationDuration = (1.8 + Math.random()*1.4) + 's';
            el.style.animationTimingFunction = 'linear';
            el.style.zIndex = 140;
            document.body.appendChild(el);
            setTimeout(()=> el.remove(), 2600 + Math.random()*800);
        }
    }

    // === Schreibmaschinen-Effekt ===
    function typeText(text, container, speed=36, clearBefore=true){
        return new Promise((resolve)=>{
            if(clearBefore) container.textContent='';
            let i=0;
            const t = setInterval(()=>{
                container.textContent += text.charAt(i);
                i++;
                if(i>=text.length){ clearInterval(t); resolve(); }
            }, speed);
        });
    }

    // === Geschenk öffnen (einzige Definition) ===
    let isOpen = false;
    async function openGift(){
        if(isOpen) return;
        isOpen = true;

        const lid = document.getElementById('gift-lid');
        const box = document.getElementById('gift-box');
        const message = document.getElementById('message');
        const messageBox = document.getElementById('message-box');
        const typed = document.getElementById('typed-text');
        const bowLeft = document.getElementById('bow-left');
        const bowRight = document.getElementById('bow-right');
        const bowCenter = document.getElementById('bow-center');

        // kurz schütteln
        const giftContainer = document.getElementById('gift-container');
        giftContainer.classList.add('shake');
        setTimeout(()=> giftContainer.classList.remove('shake'), 600);

        // user gesture -> starte Musik falls pausiert
        toggleMusic(true);

        // Schleifen & Knoten aufklappen
        setTimeout(()=>{
            bowLeft.classList.add('open-bow-left');
            bowRight.classList.add('open-bow-right');
            bowCenter.classList.add('open-bow-center');
        }, 300);

        // Deckel öffnen
        setTimeout(()=>{
            lid.classList.add('open-lid');

            // Berechne Konfetti-Startpunkt: Mitte der Box (relativ zum viewport)
            const rect = box.getBoundingClientRect();
            const originX = Math.round(rect.left + rect.width/2);
            const originY = Math.round(rect.top + 8); // leicht oberhalb der Box-Mitte, damit es "aus dem Geschenk" kommt

            // Konfetti aus Geschenk
            confettiBurstFrom(originX, originY, 52);

            // Nachricht anzeigen, Schreibmaschinen-Effekt
            setTimeout(()=>{
                message.classList.remove('hidden');
                setTimeout(()=> messageBox.classList.add('scale-100'), 30);

                const text = "Frohe Weihnachten! ✨ Möge dein Herz warm und dein Zuhause hell sein.";
                typeText(text, typed, 36).then(()=> {
                    // optional: weitere Aktionen nach dem Text
                });
            }, 480);

        }, 700); // öffne nach kurzer Verzögerung, synchron zur Animation
    }

    // === Schneeflocken wie zuvor ===
    function createSnowflake(){
        const snowflake = document.createElement('div');
        snowflake.className = 'snowflake';
        snowflake.style.left = Math.random()*100 + '%';
        snowflake.style.animationDuration = (Math.random()*3 + 2) + 's';
        snowflake.style.opacity = Math.random()*0.4 + 0.4;
        const size = Math.random()*9 + 3;
        snowflake.style.width = size + 'px';
        snowflake.style.height = size + 'px';
        const blur = Math.random()*3;
        snowflake.style.filter = `blur(${blur}px)`;
        document.getElementById('snow-container').appendChild(snowflake);
        setTimeout(()=> snowflake.remove(), 5000);
    }
    setInterval(createSnowflake, 150);

    // === Keyboard shortcut Space toggles Musik (außer Inputs) ===
    window.addEventListener('keydown', (e)=>{
        if(e.code === 'Space' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA'){
            e.preventDefault();
            toggleMusic(false);
        }
    });

    // === On load ===
    document.addEventListener('DOMContentLoaded', ()=>{
        initMusic();
        // wenn user irgendwo klickt und localStorage sagt "play", versuche zu starten
        document.body.addEventListener('click', ()=> {
            const shouldPlay = localStorage.getItem(LS_PLAY_KEY) === 'true';
            if(shouldPlay && audio.paused){
                audio.play().then(()=> {}).catch(()=> showStartHint());
            }
        });
    });

</script>
</body>
</html>
