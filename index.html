<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Weihnachtsgeschenk</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* === (Dein bisheriges CSS bleibt hier unverändert) === */
        :root {
            --red-primary: #dc2626;
            --red-dark: #991b1b;
            --gold: #fbbf24;
            --gold-light: #fcd34d;
            --gold-dark: #f59e0b;
            --green: #059669;
            --green-dark: #047857;
        }
        @keyframes shake { 0%,100%{transform:rotate(0)} 25%{transform:rotate(-5deg)} 75%{transform:rotate(5deg)} }
        @keyframes openGift {0%{transform:rotateX(0deg)}100%{transform:rotateX(-120deg)}}
        @keyframes bounce {0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
        @keyframes pulse {0%,100%{transform:scale(1);opacity:0.8}50%{transform:scale(1.1);opacity:1}}
        @keyframes twinkle {0%,100%{opacity:0.3}50%{opacity:1}}
        @keyframes openBowLeft {0%{transform:translate(0,0) rotate(-12deg)}100%{transform:translate(-60px,-20px) rotate(-45deg);opacity:0}}
        @keyframes openBowRight {0%{transform:translate(0,0) rotate(12deg)}100%{transform:translate(60px,-20px) rotate(45deg);opacity:0}}
        @keyframes openBowCenter {0%{transform:translate(-50%,-50%) rotate(45deg) scale(1)}100%{transform:translate(-50%,-50%) rotate(45deg) scale(0);opacity:0}}
        @keyframes openBowTails {0%{transform:translateY(0) scale(1)}100%{transform:translateY(-30px) scale(0.5);opacity:0}}
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }
        @keyframes sway {0%,100%{transform:translateX(0)}50%{transform:translateX(10px)}}
        @keyframes glow {0%,100%{box-shadow:0 0 5px currentColor}50%{box-shadow:0 0 20px currentColor,0 0 30px currentColor}}
        @keyframes sparkle {0%,100%{transform:scale(0) rotate(0);opacity:0}50%{transform:scale(1) rotate(180deg);opacity:1}}
        body { background: radial-gradient(ellipse at top, #1e3a8a, #1e1b4b); position:relative; overflow:hidden; }
        body::before { content:''; position:absolute; top:0; left:0; right:0; bottom:0; background: radial-gradient(2px 2px at 20% 30%, white, transparent), radial-gradient(2px 2px at 60% 70%, white, transparent), radial-gradient(1px 1px at 50% 50%, white, transparent); background-size:200px 200px; animation: twinkle 3s ease-in-out infinite; }
        .gift-pattern { background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,0.1) 10px, rgba(255,255,255,0.1) 20px); }
        .ribbon-shine { background: linear-gradient(135deg, var(--gold-light) 0%, var(--gold) 50%, var(--gold-dark) 100%); }
        .bow-shine { background: linear-gradient(135deg, var(--gold-light) 0%, var(--gold) 50%, var(--gold-dark) 100%); }
        .snowflake { position:absolute; background:white; border-radius:50%; pointer-events:none; animation: fall linear infinite; }
        .star { position:absolute; width:0; height:0; border-left:8px solid transparent; border-right:8px solid transparent; border-bottom:14px solid var(--gold); opacity:0.6; }
        .star::before { content:''; position:absolute; width:0; height:0; border-left:8px solid transparent; border-right:8px solid transparent; border-top:14px solid var(--gold); top:5px; left:-8px; }
        @media (max-width:640px){ .star{border-left:5px solid transparent; border-right:5px solid transparent; border-bottom:9px solid var(--gold);} .star::before{border-left:5px solid transparent; border-right:5px solid transparent; border-top:9px solid var(--gold); top:3px; left:-5px;} }
        .light { width:12px; height:16px; background: linear-gradient(to bottom, transparent 30%, currentColor 30%); border-radius:0 0 50% 50%; animation: glow 2s ease-in-out infinite; position:relative; }
        .light::before { content:''; position:absolute; top:-4px; left:50%; transform:translateX(-50%); width:4px; height:6px; background:#4b5563; border-radius:2px; }
        @media (max-width:640px){ .light{width:8px;height:12px;} .light::before{width:3px;height:4px;top:-3px;} }
        .sparkle{ position:absolute; width:4px; height:4px; background:white; clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%); animation:sparkle 3s ease-in-out infinite; }
        .glass{ background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border:1px solid rgba(255,255,255,0.2); }
        .shake { animation: shake 0.5s ease-in-out; }
        .open-lid { animation: openGift 0.6s ease-out forwards; transform-origin: bottom; }
        .open-bow-left { animation: openBowLeft 0.5s ease-out forwards; }
        .open-bow-right { animation: openBowRight 0.5s ease-out forwards; }
        .open-bow-center { animation: openBowCenter 0.5s ease-out forwards; }
        .open-bow-tails { animation: openBowTails 0.5s ease-out forwards; }
        .bounce-text { animation: bounce 2s ease-in-out infinite; }
        .tree{ width:0; height:0; border-left:30px solid transparent; border-right:30px solid transparent; border-bottom:50px solid var(--green); position:relative;}
        .tree::before{ content:''; position:absolute; width:0; height:0; border-left:35px solid transparent; border-right:35px solid transparent; border-bottom:60px solid var(--green-dark); top:20px; left:-35px; }
        .tree-trunk{ position:absolute; bottom:-20px; left:50%; transform:translateX(-50%); width:12px; height:20px; background:#78350f; border-radius:2px;}
        @media (max-width:640px){ .tree{border-left:15px solid transparent;border-right:15px solid transparent;border-bottom:25px solid var(--green);} .tree::before{border-left:18px solid transparent;border-right:18px solid transparent;border-bottom:30px solid var(--green-dark); top:10px; left:-18px;} .tree-trunk{width:6px;height:10px;bottom:-10px;} }

        /* ===== Musik-UI ===== */
        .music-control {
            position: fixed;
            right: 18px;
            bottom: 18px;
            z-index: 60;
            display:flex;
            gap:8px;
            align-items:center;
            background: rgba(0,0,0,0.45);
            padding: 8px 10px;
            border-radius: 999px;
            backdrop-filter: blur(6px);
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 6px 20px rgba(0,0,0,0.4);
        }
        .music-btn {
            width:44px;
            height:44px;
            display:grid;
            place-items:center;
            border-radius:999px;
            background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
            cursor:pointer;
            border:1px solid rgba(255,255,255,0.06);
        }
        .music-info {
            display:flex;
            flex-direction:column;
            gap:2px;
            color: #fff;
            font-size: 12px;
            min-width:140px;
        }
        .music-title { font-weight:600; font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:200px; }
        .music-controls-row { display:flex; gap:8px; align-items:center; }
        .volume-slider { width:100px; }
        .music-hint { font-size:11px; opacity:0.85; color:#e6e6e6; }
        .music-overlay-note {
            position: fixed;
            right: 18px;
            bottom: 82px;
            background: rgba(0,0,0,0.6);
            color: #fff;
            padding: 8px 10px;
            border-radius: 10px;
            font-size: 12px;
            z-index: 70;
            display: none;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center">
    <!-- === (Dein bestehendes Markup bleibt hier, unverändert) === -->
    <!-- Lichterkette oben -->
    <div class="fixed top-4 sm:top-8 left-0 right-0 flex justify-center gap-6 sm:gap-12 z-0">
        <div class="light text-red-500" style="animation-delay: 0s;"></div>
        <div class="light text-yellow-400" style="animation-delay: 0.3s;"></div>
        <div class="light text-green-500" style="animation-delay: 0.6s;"></div>
        <div class="light text-blue-500" style="animation-delay: 0.9s;"></div>
        <div class="light text-purple-500" style="animation-delay: 1.2s;"></div>
        <div class="light text-red-500" style="animation-delay: 1.5s;"></div>
        <div class="light text-yellow-400" style="animation-delay: 1.8s;"></div>
        <div class="light text-green-500" style="animation-delay: 2.1s;"></div>
    </div>
    <!-- Tannenbaum links -->
    <div class="fixed left-4 sm:left-12 bottom-8 sm:bottom-12 opacity-20">
        <div class="tree relative">
            <div class="tree-trunk"></div>
        </div>
    </div>
    <!-- Tannenbaum rechts -->
    <div class="fixed right-4 sm:right-12 bottom-8 sm:bottom-12 opacity-20">
        <div class="tree relative">
            <div class="tree-trunk"></div>
        </div>
    </div>
    <div class="sparkle" style="top: 20%; left: 15%; animation-delay: 0s;"></div>
    <div class="sparkle" style="top: 30%; right: 20%; animation-delay: 1s;"></div>
    <div class="sparkle" style="bottom: 25%; left: 25%; animation-delay: 2s;"></div>
    <div class="sparkle" style="top: 60%; right: 15%; animation-delay: 1.5s;"></div>

    <div class="text-center relative z-10 px-4">
        <!-- Geschenk Container -->
        <div id="gift-container" class="relative cursor-pointer perspective-1000" onclick="openGift()">
            <!-- Deckel -->
            <div id="gift-lid" class="relative z-10 mb-1 sm:mb-2">
                <div class="w-40 h-14 sm:w-56 sm:h-20 bg-gradient-to-br from-red-500 via-red-600 to-red-700 rounded-t-lg mx-auto shadow-2xl gift-pattern border-2 sm:border-4 border-red-800 relative overflow-visible">
                    <div class="absolute top-1 left-2 w-14 h-6 sm:top-2 sm:left-4 sm:w-20 sm:h-8 bg-white opacity-20 rounded-full blur-sm"></div>
                    <div class="absolute top-1/2 left-0 right-0 h-4 sm:h-6 ribbon-shine transform -translate-y-1/2 shadow-lg border-t border-b sm:border-t-2 sm:border-b-2 border-yellow-600 z-10"></div>
                    <div class="absolute top-1/2 left-0 right-0 h-0.5 sm:h-1 bg-yellow-300 transform -translate-y-1/2 z-10"></div>
                    <div class="absolute top-0 bottom-0 left-1/2 w-4 sm:w-6 ribbon-shine transform -translate-x-1/2 shadow-lg border-l border-r sm:border-l-2 sm:border-r-2 border-yellow-600 z-10"></div>
                    <div class="absolute top-0 bottom-0 left-1/2 w-0.5 sm:w-1 bg-yellow-300 transform -translate-x-1/2 z-10"></div>
                    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-20">
                        <div id="bow-center" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 rotate-45 z-30 w-5 h-5 sm:w-8 sm:h-8 bow-shine rounded shadow-xl border border-yellow-600 sm:border-2"></div>
                        <div id="bow-left" class="absolute top-1/2 left-1/2 transform -translate-y-1/2 -translate-x-full -rotate-12">
                            <div class="w-8 h-8 sm:w-12 sm:h-12 bow-shine rounded-full shadow-xl border border-yellow-600 sm:border-2 -ml-1 sm:-ml-2"></div>
                            <div class="absolute top-0.5 left-0.5 w-7 h-7 sm:top-1 sm:left-1 sm:w-10 sm:h-10 bg-gradient-to-br from-amber-300 to-yellow-400 rounded-full opacity-60"></div>
                        </div>
                        <div id="bow-right" class="absolute top-1/2 left-1/2 transform -translate-y-1/2 rotate-12">
                            <div class="w-8 h-8 sm:w-12 sm:h-12 bow-shine rounded-full shadow-xl border border-yellow-600 sm:border-2 -mr-1 sm:-mr-2"></div>
                            <div class="absolute top-0.5 left-0.5 w-7 h-7 sm:top-1 sm:left-1 sm:w-10 sm:h-10 bg-gradient-to-br from-amber-300 to-yellow-400 rounded-full opacity-60"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Geschenkbox -->
            <div class="w-40 h-40 sm:w-56 sm:h-56 bg-gradient-to-br from-red-500 via-red-600 to-red-800 mx-auto shadow-2xl rounded-b-lg relative gift-pattern border-2 sm:border-4 border-red-800">
                <div class="absolute top-2 left-3 w-16 h-20 sm:top-4 sm:left-6 sm:w-24 sm:h-32 bg-white opacity-20 rounded-full blur-md"></div>
                <div class="absolute top-0 bottom-0 left-1/2 w-5 sm:w-8 ribbon-shine transform -translate-x-1/2 shadow-lg border-l border-r sm:border-l-2 sm:border-r-2 border-yellow-600"></div>
                <div class="absolute top-0 bottom-0 left-1/2 w-0.5 sm:w-1 bg-yellow-300 transform -translate-x-1/2"></div>
                <div class="star absolute" style="top: 20px; left: 20px;"></div>
                <div class="star absolute" style="bottom: 35px; right: 20px; transform: scale(0.8);"></div>
                <div class="star absolute" style="top: 50%; right: 10px; transform: scale(0.6);"></div>
                <div class="absolute -bottom-2 sm:-bottom-4 left-1/2 transform -translate-x-1/2 w-44 h-6 sm:w-64 sm:h-8 bg-black opacity-30 blur-xl rounded-full"></div>
            </div>
        </div>

        <!-- Nachricht (versteckt) -->
        <div id="message" class="hidden fixed inset-0 flex items-center justify-center z-50 px-4">
            <div class="glass rounded-2xl p-4 sm:p-8 shadow-2xl transform scale-0 transition-transform duration-500 border-2 border-white/30 max-w-sm" id="message-box">
                <p class="text-white font-bold text-lg sm:text-2xl drop-shadow-lg text-center">Schade, vielleicht im nächsten Geschenk!</p>
            </div>
        </div>

        <!-- Schneefall Container -->
        <div class="fixed inset-0 pointer-events-none" id="snow-container"></div>
    </div>

    <!-- ===== Hintergrundmusik (ersetze src mit deiner MP3) ===== -->
    <audio id="bg-music" loop preload="auto">
        <source src="dein_lied.mp3" type="audio/mpeg">
        Dein Browser unterstützt kein Audio-Tag.
    </audio>

    <!-- ===== Musik Kontroll-UI ===== -->
    <div class="music-control" id="music-control" aria-hidden="false">
        <button class="music-btn" id="music-toggle" title="Musik abspielen / pausieren" aria-label="Musik abspielen">
            <!-- Play / Pause Icon (SVG) -->
            <svg id="icon-play" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
            <svg id="icon-pause" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
        </button>

        <div class="music-info">
            <div class="music-title" id="music-title">Weihnachtsmusik</div>
            <div class="music-controls-row">
                <input id="volume" class="volume-slider" type="range" min="0" max="1" step="0.01" />
                <div class="music-hint" id="music-state">Pause</div>
            </div>
        </div>
    </div>

    <div class="music-overlay-note" id="music-note">Tippe zum Starten der Musik</div>

<script>
    // ===== Variablen / Elemente =====
    const audio = document.getElementById('bg-music');
    const toggleBtn = document.getElementById('music-toggle');
    const iconPlay = document.getElementById('icon-play');
    const iconPause = document.getElementById('icon-pause');
    const volumeSlider = document.getElementById('volume');
    const musicState = document.getElementById('music-state');
    const musicNote = document.getElementById('music-note');

    // ===== Hilfsfunktionen für Fade In / Out =====
    function fadeAudioTo(targetVolume = 0.6, duration = 800) {
        const start = audio.volume;
        const diff = targetVolume - start;
        const stepTime = 50;
        const steps = Math.max(1, Math.floor(duration / stepTime));
        let cur = 0;
        const timer = setInterval(() => {
            cur++;
            audio.volume = Math.min(1, Math.max(0, start + (diff * (cur / steps))));
            if (cur >= steps) clearInterval(timer);
        }, stepTime);
    }
    function fadeOutAndPause(duration = 500) {
        const start = audio.volume;
        const stepTime = 50;
        const steps = Math.max(1, Math.floor(duration / stepTime));
        let cur = 0;
        const timer = setInterval(() => {
            cur++;
            audio.volume = Math.max(0, start * (1 - cur / steps));
            if (cur >= steps) {
                clearInterval(timer);
                audio.pause();
            }
        }, stepTime);
    }

    // ===== localStorage keys =====
    const LS_PLAY_KEY = 'xmasMusicPlaying';
    const LS_VOL_KEY = 'xmasMusicVolume';

    // ===== Initialisierung =====
    function initMusicUI() {
        // Lade Lautstärke aus localStorage (oder Standard 0.6)
        let savedVol = parseFloat(localStorage.getItem(LS_VOL_KEY));
        if (isNaN(savedVol)) savedVol = 0.6;
        audio.volume = savedVol;
        volumeSlider.value = savedVol;

        // Lade play-state
        const shouldPlay = localStorage.getItem(LS_PLAY_KEY) === 'true';
        updateToggleUI(shouldPlay ? true : false);

        // Wenn vorher gespielt wurde, versuche zu spielen (nur funktioniert wenn Browser
        // das Autoplay nach vorheriger Nutzerinteraktion zulässt)
        if (shouldPlay) {
            try {
                const p = audio.play();
                if (p && p.then) {
                    p.then(() => {
                        // erfolgreich gestartet
                        updateToggleUI(true);
                    }).catch(err => {
                        // Blockiert -> zeige Hinweis
                        showStartHint();
                        updateToggleUI(false);
                    });
                }
            } catch (e) {
                showStartHint();
                updateToggleUI(false);
            }
        }
    }

    // ===== UI Update =====
    function updateToggleUI(isPlaying) {
        if (isPlaying) {
            iconPlay.style.display = 'none';
            iconPause.style.display = 'block';
            musicState.textContent = 'Wiedergabe';
            toggleBtn.setAttribute('aria-label','Musik pausieren');
        } else {
            iconPlay.style.display = 'block';
            iconPause.style.display = 'none';
            musicState.textContent = 'Pause';
            toggleBtn.setAttribute('aria-label','Musik abspielen');
        }
    }

    // ===== Play / Pause Handler =====
    async function toggleMusic(userInitiated = true) {
        if (!audio) return;
        if (audio.paused) {
            try {
                await audio.play();
                // Fade in wenn userInitiated
                if (userInitiated) fadeAudioTo(parseFloat(volumeSlider.value), 700);
                localStorage.setItem(LS_PLAY_KEY, 'true');
                updateToggleUI(true);
                hideStartHint();
            } catch (err) {
                // Play wurde blockiert (kein user gesture) -> zeige Hinweis
                showStartHint();
                updateToggleUI(false);
                console.warn('Autoplay blockiert:', err);
            }
        } else {
            // fade out und pausieren
            fadeOutAndPause(500);
            localStorage.setItem(LS_PLAY_KEY, 'false');
            updateToggleUI(false);
        }
    }

    // ===== Volume Handler =====
    volumeSlider.addEventListener('input', (e) => {
        const v = parseFloat(e.target.value);
        audio.volume = v;
        localStorage.setItem(LS_VOL_KEY, String(v));
    });

    // Klick auf Play/Pause-Button
    toggleBtn.addEventListener('click', () => toggleMusic(true));

    // Helfer: Hinweis einblenden wenn Play blockiert wurde
    function showStartHint() {
        musicNote.style.display = 'block';
        setTimeout(() => { musicNote.style.opacity = '1'; }, 10);
    }
    function hideStartHint() {
        musicNote.style.opacity = '0';
        setTimeout(() => { musicNote.style.display = 'none'; }, 300);
    }

    // Wenn user auf Geschenk klickt, öffnen und Musik starten (falls noch nicht)
    let isOpen = false;
    function openGift() {
        if (isOpen) return;
        isOpen = true;

        const lid = document.getElementById('gift-lid');
        const message = document.getElementById('message');
        const messageBox = document.getElementById('message-box');
        const giftContainer = document.getElementById('gift-container');
        const bowLeft = document.getElementById('bow-left');
        const bowRight = document.getElementById('bow-right');
        const bowCenter = document.getElementById('bow-center');

        giftContainer.classList.add('shake');

        // Versuche, Musik zu starten, falls pausiert
        // Das ist eine echte Nutzeraktion -> Browser erlaubt normalerweise Play
        toggleMusic(true);

        setTimeout(() => {
            bowLeft.classList.add('open-bow-left');
            bowRight.classList.add('open-bow-right');
            bowCenter.classList.add('open-bow-center');

            setTimeout(() => {
                lid.classList.add('open-lid');

                setTimeout(() => {
                    message.classList.remove('hidden');
                    setTimeout(() => {
                        messageBox.classList.add('scale-100');
                    }, 50);
                }, 400);
            }, 500);
        }, 500);
    }

    // Schneeflocken-Logik (wie zuvor)
    function createSnowflake() {
        const snowflake = document.createElement('div');
        snowflake.className = 'snowflake';
        snowflake.style.left = Math.random() * 100 + '%';
        snowflake.style.animationDuration = (Math.random() * 3 + 2) + 's';
        snowflake.style.opacity = Math.random() * 0.4 + 0.4;
        const size = Math.random() * 9 + 3;
        snowflake.style.width = size + 'px';
        snowflake.style.height = size + 'px';
        const blur = Math.random() * 3;
        snowflake.style.filter = `blur(${blur}px)`;
        document.getElementById('snow-container').appendChild(snowflake);

        setTimeout(() => {
            snowflake.remove();
        }, 5000);
    }
    setInterval(createSnowflake, 150);

    // ===== Shortcut: Leertaste togglet Musik (optional) =====
    window.addEventListener('keydown', (e) => {
        if (e.code === 'Space' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
            e.preventDefault();
            toggleMusic(false);
        }
    });

    // ===== On Load =====
    document.addEventListener('DOMContentLoaded', () => {
        initMusicUI();

        // Falls initial play blocked und Benutzer direkt irgendwo klickt -> versuchen noch mal
        document.body.addEventListener('click', () => {
            const shouldPlay = localStorage.getItem(LS_PLAY_KEY) === 'true';
            if (shouldPlay && audio.paused) {
                audio.play().then(()=> hideStartHint()).catch(()=> showStartHint());
            }
        }, { once: false });
    });

</script>
</body>
</html>
